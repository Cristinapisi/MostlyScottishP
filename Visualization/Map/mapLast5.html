<!DOCTYPE html>
<meta charset="utf-8">
<style>
		.tooltip {
    position: absolute;													
    font: 12px;
    font-weight: bold;
    border-radius: 5px;				
}
		</style>
<body>
<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="http://d3js.org/topojson.v1.min.js"></script>
<script>
    var w=960, h=750;
var pLoad = [];
var parties={};

var border = .5;
var bordercolor = "black";

var gssCode = {
    "S12000005":"Central",
    "S12000014":"Central",
    "S12000030":"Central",
    "S12000006":"Dumfries and Galloway",
    "S12000008":"Strathclyde",
    "S12000011":"Strathclyde",
    "S12000018":"Strathclyde",
    "S12000021":"Strathclyde",
    "S12000028":"Strathclyde",
    "S12000029":"Strathclyde",
    "S12000035":"Strathclyde",
    "S12000038":"Strathclyde",
    "S12000039":"Strathclyde",
    "S12000044":"Strathclyde",
    "S12000045":"Strathclyde",
    "S12000046":"Strathclyde",
    "S12000010":"Lothian",
    "S12000019":"Lothian",
    "S12000026":"Lothian",
    "S12000036":"Lothian",
    "S12000040":"Lothian",
    "S12000013":"Highland",
    "S12000017":"Highland",
    "S12000023":"Highland",
    "S12000027":"Highland",
    "S12000015":"Fife",
    "S12000020":"Grampian",
    "S12000033":"Grampian",
    "S12000034":"Grampian",
    "S12000024":"Tayside",
    "S12000041":"Tayside",
    "S12000042":"Tayside"
};

var color = {
    "Central" : "#5ABFF4",
    "Dumfries and Galloway" : "#EB2743",
    "Scottish Liberal Democrats" : "#FF784E",
    "Strathclyde" : "#F6DC60",
    "Lothian" : "#31C48E",
    "Highland" : "#986561",
    "Grampian" : "#475070",
    "Tayside" : "#000",
    "Fife": "#FF6936"
};


var projection = d3.geo.albers()
    .center([0, 55.4])
    .rotate([4.4, 0])
    .parallels([50, 60])
    .scale(9000)
    .translate([w/2, h/1.2]);

var path = d3.geo.path()
    .projection(projection);

var svg = d3.select("body")
    .append("svg")
    .attr("width",w)
    .attr("height",h)
    .style("background","#fff");
    
var borderPath = svg.append("rect")
       			.attr("x", 0)
       			.attr("y", 0)
       			.attr("height", h)
       			.attr("width", w)
       			.style("stroke", bordercolor)
       			.style("fill", "none")
       			.style("stroke-width", border);
       			

       			
// add the tooltip area to the webpage
			var tooltip = d3.select("body").append("div")
    		.attr("class", "tooltip")
   		 	.style("opacity", 0);

var generateVisualization = function()
{
console.log(parties);
d3.json("scotland-topojson-file.json",function(err,load){
    svg.selectAll("path")
        .data(topojson.feature(load,load.objects.layer1).features)
      .enter().append("path")
        .attr("d",path)
        .style("fill",function(d){return color[gssCode[d.properties.gss]];})
        .style("opacity", 0.6)
        .style("stroke", "#fff")
      	.append("title")
        .text(function(d){
        var str = gssCode[d.properties.gss];
		var object = parties[gssCode[d.properties.gss]];
		for(i=0; i<6;i++){
		if(object["SCU"] > 0)
			str = str+"\n"+"SCU: "+object["SCU"];
		if(object["SL"] > 0)
			str = str+"\n"+"SL: "+object["SL"];
		if(object["SLD"] > 0)
			str = str+"\n"+"SLD: "+object["SLD"];
		if(object["Independent"] > 0)
			str = str+"\n"+"Independent: "+object["Independent"];
		if(object["SN"] > 0)
			str = str+"\n"+"SN: "+object["SN"];
		if(object["SG"] > 0)
			str = str+"\n"+"SG: "+object["SG"];
		if(object["No Party"] > 0)
			str = str+"\n"+"No Party: "+object["No Party"];
		return str;	
		}       
        });
});
};

d3.csv("map_data copy.csv", function(error, d) {
  				pLoad = d.map(function(d) { return [d["Region"],+d["SCU"],+d["SL"],+d["SLD"],+d["SN"],+d["SG"],+d["Independent"],+d["No Party"]]; 
  				});
  				
  				for (i = 0; i < 8; i++) { 
    			parties[pLoad[i][0]] = {"SCU": pLoad[i][1], "SL": pLoad[i][2], "SLD": pLoad[i][3], "SN": pLoad[i][4], "SG": pLoad[i][5], "Independent": pLoad[i][6], "No Party": pLoad[i][7]};
				}
  				generateVisualization();});
</script>
</body>